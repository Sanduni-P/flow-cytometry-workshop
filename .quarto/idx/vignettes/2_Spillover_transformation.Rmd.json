{"title":"Spillover, compensation, and Transformations","markdown":{"yaml":{"title":"Spillover, compensation, and Transformations","vignette":"%\\\\VignetteIndexEntry{Spillover, compensation, Transformations} %\\\\VignetteEngine{knitr::rmarkdown} %\\\\VignetteEncoding{UTF-8}\n"},"headingText":"Background","containsRefs":false,"markdown":"\n\n```{r,include=FALSE, echo=FALSE,eval=TRUE}\nlibrary(ggcyto)\nlibrary(flowCore)\nlibrary(flowWorkspace)\nlibrary(flowStats)\n```\n\n\nIn this section, we aim to clarify the concept of Spillover, and the use of **spillover** matrix to correct for this. The last part of this section will deal with various transformations of the underlying expression data to aid in visualization and interpretation.\n\n## Spillover\n\nFlow cytometers (optics based: spectral or non-spectral) collect fluorescent signal from a cell as result of a laser excitation. Briefly, cell type **C** has been labelled with a marker **M** that is conjugated to a fluorophore (**F**). **F** is excited by a laser resulting in fluorescence. While the fluorescence has a emission maxima, the emission profile of **F** can span many nanometers. The cytometer has a dedicated detector (channel) **A** to detect peak emission of **F**. However, due to the spread of the emission of **F**, some signal from **F** is also \"spilled\" onto detector **B**, a detector for a different fluorophore.\n\nThe image below provides a concrete example.\n\n![Excitation/Emission spectra for FITC. Taken from Bio-Rad. A is the dedicated detector for FITC. B is a secondary detector where FITC signal spills over.](https://static.bio-rad-antibodies.com/2016/flow-cytometry/fig-9-spectral-profiles.png)\n\nThe **spillover** of signal onto secondary detector(s) is *additive* and can be easily recovered (more on this below).\n\nRaw Signal in $B = \\text{Signal from FITC (spillover)} + \\text{Signal from another (perhaps dedicated) fluorophore}.$\n\nFITC signal detected erroneously by secondary detectors can be estimated by a process of **fluorescence compensation** which requires a set of controls be present to calculate the spillover. These controls are called *Single Colour Controls* and are acquired prior to sample acquisition. The purpose of the single colour control is to estimate the amount of spillover of emission from fluorophore **F** onto non-primary detectors (detector **B** in the image above).\n\nWe note, but will not discuss further here that there are a class of more advanced fluorescence-based cytometers known as *spectral* flow cytometers. Spectral instruments require a different and more specialized procedure to perform compensation.\n\n## Importance of spillover correction\n\nLet's visualize the data to highlight the main issues related to spillover. We will make use of the `ggcyto` library from the `cytoverse` for this. We will dive into more details on the usage of `ggcyto` in a later section, as well as the \"transformation\" we are applying. For the moment, think of this transformation as a glorified log-transform to visualize the fluorescent signal that spans several orders of magnitude.\n\n```{r viz_uncompensated_data, echo=FALSE, eval=T, message=FALSE, fig.width=10}\n# read file\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")[,-32]\n\n# define transformation\ntrans <- transformList(\n  from = names(markernames(cf)),\n  tfun = (function(x)asinh(x/500))  # user definition\n) \n\n# transform\n# notice that we are creating a copy of the data\ncf_trans <- transform(\n  realize_view(cf),\n  trans\n)\n\n# plot\nuncompensated <- as.ggplot(\n  ggcyto(\n    cf_trans, # flowFrame, flowSet, cytoframe, cytoset, GatingSet, or GatingHierarchy can be used as data source\n    aes(x = \"CD3\", y = \"CD5\")  # automatic matching of markernames\n  ) + \n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Uncompensated data\")\n)\n\n# compensate\ncf_comp <- compensate(\n  realize_view(cf),\n  spillover(cf)[[\"$SPILLOVER\"]]\n)\n\n# transform\ncf_comp <- transform(cf_comp,trans)\n\n# plot\ncompensated <- as.ggplot(\n  ggcyto(\n    cf_comp, \n    aes(x = \"CD3\", y = \"CD5\")\n  ) +\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Compensated data\")+\n  axis_x_inverse_trans() # axis is transformed instead of data\n) \n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  uncompensated,\n  compensated,\n  nrow = 1, \n  top = \"1. Dicficulty resolving the correct populations\"\n)\n\n# plot uncompensated data\nuncompensated <- as.ggplot(\n  ggcyto(\n    cf_trans, \n    aes(x = \"SSC-A\", y = \"Live\")\n  )+\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Uncompensated data\")\n)\n\n# plot compensated data\ncompensated <- as.ggplot(\n  ggcyto(\n    cf_comp, \n    aes(x = \"SSC-A\", y = \"Live\")\n  )+\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Compensated data\")\n)\n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  uncompensated, \n  compensated, \n  nrow = 1, \n  top = \"2. Wrong conclusions\"\n)\n\n```\n\nIn example 1, the 2 fluorophores: PE-Cy5 and PE-Cy5.5 are spilling onto each other, making it impossible to resolve CD3+ (T cells) from non-T cells. However, after correcting for spillover (2nd plot), we see that two populations are visible in the G660-A CD3 PE-Cy5 channel.\n\nIn example 2, we see a population of events that are positive of marker: **Live Dead UV Blue**. It would be tempting to exclude these events as this marker is used to identify dead cells. However, in correctly compensated data, we see that this population actually is not present, but rather was an artifact of another dye spilling onto the U450 channel!\n\n## Spillover matrix: What does it look like? Where do you find it? How can you use it?\n\n### Embedded with the **.fcs** file\n\nIn many cases, the spillover matrix (which is used to correct the spillover) is attached to the **.fcs** files within `$SPILLOVER`,`SPILL`,or `SPILL` **keywords**. In `cytoverse`, we can check for the presence of by using the function `spillover(cf)`.\n\n#### Example: absent or incorrect\n\nFor this example, we are using data from the following dataset [FR-FCM-ZZ36](https://flowrepository.org/id/FR-FCM-ZZ36). The data was published in this [manuscript](10.1002/cyto.a.22278).\n\n```{r absent_spill, eval=TRUE, echo=TRUE, message=FALSE}\n# absent spill\ncf_absent <- load_cytoframe_from_fcs(\"data/FlowRepository_FR-FCM-ZZ36_files/pbmc_luca.fcs\")\n\n# check spillover results\nspillover(cf_absent)\n```\n\nNotice that there are 3 slots. Importantly, we notice a matrix within `$SPILL` slot which has 1's in the diagonal and 0's elsewhere. This is an identity matrix.\n\nObserving an identity matrix is likely an indication that the spillover has not been calculated. If this is the case, please see the section: [Calculating spillover from single colour controls (optional)].\n\n#### Example: valid spillover\n\nFor this example, we are using the dataset from [FR-FCM-Z5PC](https://flowrepository.org/public_experiment_representations/5932). The dataset was published in the following [paper](https://doi.org/10.1038/s41467-022-34638-2).\n\n```{r show_spill, echo=T, message=TRUE}\n# load cytoframe\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")\n\n# show spillover\nspillover(cf)\n```\n\nWe notice a few important details.\n\n-   It is not necessary that all 3 keywords have a matrix. Nor is it necessary that the matrix be present in a specific keyword.\n\n-   The spillover matrix is **square**. This is because the user will run 1 single colour control for each channel/marker they intend to acquire. In this example its 28 x 28\n\n-   The spillover matrix is non-identity with 1's in the diagonal!\n\nThe columns of the spillover matrix are the **detectors** while the rows are contribution from each **fluorophore**. Visualizing it as a heatmap is sometimes more helpful\n\n```{r explain_spillover, echo=FALSE, eval=TRUE, fig.height=10, fig.width=10}\n# extract spillover\ns.mat <- spillover(cf)[[3]]\nrownames(s.mat) <- markernames(cf)[-29]\n\npheatmap::pheatmap(\n  mat = s.mat,\n  cluster_rows = F,\n  cluster_cols = F,\n  color = colorRampPalette(\n    c(\"black\",\"orange\",\"cyan\",\"magenta\")\n  )(100),\n  display_numbers = T,\n  number_format = \"%.2f\",\n  legend = FALSE,\n  number_color = \"white\"\n)\n```\n\nLooking at the figure, column 2: B610-A (detector for fluorophore BB630) has high spillover from flurophore: PE-Dazzle594 and PE.\n\nIn fact, when we look at the emission spectrum of the 2 dyes (PE and BB630) we see that this issue is apparent:\n\n![Spectra from PE and BB630P2.](images/spectrumChart.png)The image was created at <https://www.bdbiosciences.com/en-ca/resources/bd-spectrum-viewer> using the BD spectrum viewer tool.\n\n### Using the spillover matrix\n\nNow that we have a valid spillover matrix, how do we use it to correct the data?\n\nFirst, we would like to highlight: **SPILLOVER CORRECTION IS DONE ON THE RAW (UNTRANSFORMED) DATA.**\n\nNow to perform spillover correction (**Compensation**). In the `cytoverse` this is done by a simple call to `compensate`.\n\n```{r compensate, echo=TRUE, eval=TRUE,message=FALSE}\n# single call to compensate \n# spillover(cf)[[3]] indicates where the matrix to use lives\ncf_comp <- compensate(\n  x = realize_view(cf),\n  spillover = spillover(cf)[[3]]\n) \n```\n\n\n## Transformation and visualization\n\nCytometry data tends to have a very high dynamic range. For example: the range of values in `PE-Cy5-5-A` channel in the FCS we have been working with is `-111 2621543`. The difference between cells that do not express a marker of interest and a cell that expresses variable level of marker could be order of magnitude. In such a scenario, transformation of the data can aid in **better visualization and representation of the biological phenomena**.\n\nThere are multiple approaches to transform the data in `cytoverse`. We will identify a few common ones as well as demonstrate how to create new transformations.\n\nFirst, let's visualize why transformation is necessary. We go back to working with data from [FR-FCM-Z5PC](https://flowrepository.org/public_experiment_representations/5932).\n\n```{r demo_transformations, echo=FALSE, eval=T, fig.width=10, fig.height=10}\n# read in fcs\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")\n\n# apply compensation\ncf <- compensate(\n  cf, \n  spillover(cf)[[3]]\n)\n\n# plot linear compensated data\nlinear <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  ) +\n  labs(title = \"No transformation applied\")\n)\n\n# plot biexponential compensated data\nbiexp <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_flowjo_biexp()+\n  scale_y_flowjo_biexp()+\n  labs(title = \"Biexponential\"))\n\n# plot log compensated data\nlog_trans <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_continuous(trans = flowWorkspace::flowjo_log_trans())+\n  scale_y_continuous(trans = flowWorkspace::flowjo_log_trans())+\n  labs(title = \"Log\")\n)\n\n# plot asinh compensated data\nasinh_t <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_flowjo_fasinh()+\n  scale_y_flowCore_fasinh()+\n  labs(title = \"inverse hyperbolic sine\")\n)\n\n# plot logicle compensated data\nlogicle <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_logicle()+\n  scale_y_logicle()+\n  labs(title = \"Logicle\")\n)\n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  linear,\n  biexp, \n  log_trans,\n  asinh_t, \n  logicle, \n  nrow = 2,\n  bottom = \"Generic transformations of compensated data\"\n)\n```\n\nAs we see, the variety of transformations aids in visualization and interpretation of the data.\n\nAlso note that the choice of transformation can and will affect the interpretation. As such, use a healthy dose of caution and follow established best practices. As well, when in doubt, talk to your collaborators.\n\n### Steps to transform data\n\nThe `cytoverse` libraries: `flowWorkspace` and `flowCore` have a multiple commonly used transformations (some are shown above) as well, one can also create a custom transformation if required.\n\nLet's first use a built in transformation.\n\n```{r how_to_transform_builtin, echo=T, eval=T, message=F}\n# transforming using cytoverse functions\n# define a transformation\nasinh_trans <- flowWorkspace::asinh_Gml2()\n\n# create a transformList that indicates which parameters to transform\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ),\n  tfun = asinh_trans\n)\n\n# transform \ncf_transformed <- flowCore::transform(\n  realize_view(cf),\n  my_trans_list\n)\n\n```\n\n```{r viz_transform, echo=FALSE, eval=TRUE, message=FALSE}\n# visualize linear compensated\ncf_comp <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\", \n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# visualize transformed compensatd\ncf_comp_transformed <- as.ggplot(\n  autoplot(\n    cf_transformed,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# arrange plot for comparison\ngridExtra::grid.arrange(\n  cf_comp, \n  cf_comp_transformed, \n  nrow = 1\n)\n```\n\nAnother option is to use a user defined transformation.\n\n```{r user_defined_transformation,echo=TRUE,eval=TRUE}\n# define a transformation\nmy_trans <- function(x){\n  return(sqrt(abs(x)))\n}\n\n# create a transformList\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ), \n  tfun = my_trans\n)\n\n# transform\ncf_transformed <- transform(\n  realize_view(cf),\n  my_trans_list\n)\n```\n\n```{r viz_transform_user_defined, echo=FALSE, eval=FALSE, message=FALSE}\n# visualize custom transfromed compensated\ncf_comp_transformed <- as.ggplot(\n  autoplot(\n    cf_transformed,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# arrange plots to compare with unstransformed data\ngridExtra::grid.arrange(\n  cf_comp,\n  cf_comp_transformed, \n  nrow = 1\n)\n```\n\nWe can also transform a set of FCS files (`cytoset`)\n\n```{r transform_cytoset, echo=TRUE, eval=TRUE}\n# read in a cytoset\ncs <- load_cytoset_from_fcs(path = \"data/fcs-data/\")\n\n# extract per file compensation matrix into a list\ncompensation_list <- lapply(cytoset_to_list(cs),\n                            function(x)spillover(x)[[3]])\n\n# compensate\ncs <- compensate(cs, compensation_list)\n\n# using asinh_trans defined previously\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ),\n  tfun = asinh_trans\n)\n\n# transform: this will transform the underlying data \ncs <- transform(cs,my_trans_list)\n```\n\n### Exercise\n\n1.  How can you tell if the data have been compensated? Use your preferred plotting method to generate a scatter plot for the following markers: `CADM1` and `CD141` from `cf` and `cf_comp`. You may need to transform the data for appropriate visualization.\n2.  Suppose the **.fcs** file does not have a spillover matrix or has an identity matrix. How confident can you be the data have been previously compensated (or not) ?\n\n# Conclusion\n\nIn this section we have described the concept of **spillover** and how to use the `spillover` matrix to correct for this phenomenon. As well, we described an approach to generate the `spillover` matrix when it is has not be pre-populated in the **.fcs** files. We also highlighted several built-in transformations in `cytoverse` as well as approaches to generate new user defined transformations. Data transformation is topic that can require several workshops in itself. As such, we encourage users/analyst to follow best and appropriate practices. A highly informative reading is the following: [An updated guide for the perplexed: cytometry in the high-dimensional era](https://pubmed.ncbi.nlm.nih.gov/34489590/).\n\n# Calculating spillover from single colour controls (optional)\n\nYou have noticed that there is no spillover matrix or an identity matrix is present when you call `spillover(cf)`. What can we do to calculate the spillover matrix in this scenario?\n\n<details>\n\nFirst, verify that you have additional set of **.fcs** files which either have **Compensation** or **control** in the file name. These control files are generally generated as part of experiment/instrument set up before acquisition begins. *If they are not available, please reach out to your collaborator or flow core manager.*\n\nGenerally, there ought to be the **same number** of single colour controls as the number of markers being assessed + 1 unstained to estimate the background auto-fluorescence.\n\nFor demonstration purposes, we will use single colour controls from the dataset: [FR-FCM-ZZ36](https://flowrepository.org/id/FR-FCM-ZZ36). The data was published in this [manuscript](10.1002/cyto.a.22278).\n\nHere, we will make use of a csv file which maps the control files to their respective channel as well as identifies the **unstained** file. *Note*: You may need to prepare such file in advance when working with your specific experiment.\n\n```{r generating_spillover_with_controls, echo=TRUE, eval =TRUE, message=FALSE, fig.width = 10, fig.height=10}\nlibrary(magrittr)\n\n# load csv file \ncsv_file <- read.csv(\"data/FlowRepository_FR-FCM-ZZ36_files/control_files.csv\")\n\n# take a peek at the file\ncsv_file\n\n# load the set of compensation files\ncomp_cs <- load_cytoset_from_fcs(\n  csv_file[[\"filename\"]],\n  path = \"data/FlowRepository_FR-FCM-ZZ36_files/\"\n)\nsampleNames(comp_cs) <- csv_file[[\"channel\"]]\n```\n\n```{r comp_viz, echo=FALSE, eval=TRUE, message=FALSE, fig.width=12, out.width=\"100%\"}\n# # quick visualization of what the control files contain\n# all_control_percp <- ggcyto::as.ggplot(\n#   ggcyto(\n#     comp_cs,\n#     aes(x = \"FSC-A\", y = \"PerCP-Cy5-5-A\")\n#   )+\n#   geom_hex(bins = 256)+\n#   theme_bw()+\n#   scale_y_flowCore_fasinh(b = 1/150)+\n#   labs(title = \"Detection of PerCP-Cy5-5 in all control samples \")\n# )\n# all_control_percp\nchans <- colnames(comp_cs)[-c(1,2,17)]\nchans <- chans[-match(sampleNames(comp_cs[1]), chans)]\nplots <- lapply(\n  chans,\n  function(x) {\n    ggcyto::as.ggplot(\n      ggcyto(\n        comp_cs[1],\n        aes(x = !!sampleNames(comp_cs[1]), y = !!x)\n      ) + \n      geom_hex(bins = 256) +\n      theme_bw() +\n      scale_y_flowCore_fasinh(b = 1/150)\n    )\n  }\n)\n\ndo.call(\n  gridExtra::grid.arrange,\n  c(\n    plots,\n    ncol = 4\n  )\n)\n\n```\n\nNotice that **Alexa Fluor 405** is spilling heavily into **Alexa Fluor 430-A** and **BV605-**, but not into any of the other detectors.\n\nNow, we calculate the spillover matrix using the set of controls. We will use `spillover` function from `flowStats` package within the `cytoverse`.\n\n```{r generating_spillover_with_controls_calculate, eval = TRUE, echo = TRUE, message = FALSE}\n# calculate spillover\n## using spillover from flowStats\nspill <- flowStats::spillover(\n  comp_cs,\n  unstained = \"Unstained\", # indicate how the unstained file is named in flowset\n  patt = \"-A\", # indicate which parameter should be considered \n  fsc = \"FSC-A\",\n  ssc = \"SSC-A\",\n  stain_match = \"regexpr\",\n  useNormFilt = TRUE\n)\n```\n\nNow, let's visualize the spill matrix that we calculated.\n\n```{r viz_calculated_spill, eval=T, echo=FALSE}\npheatmap::pheatmap(\n  mat = spill,\n  cluster_rows = F,\n  cluster_cols = F,\n  color = colorRampPalette(\n    c(\"black\",\"orange\",\"cyan\",\"magenta\")\n  )(100),\n  display_numbers = T, \n  legend = FALSE,\n  number_color = \"white\",\n  number_format = \"%.3f\"\n)\n```\n\n*Note: Close or related fluorophores will have some degree of overlap.*\n\nLastly, we check the effect of *compensating* these files.\n\n```{r show_comp_effect, echo=FALSE, eval=TRUE}\n# read in FCS\ncf <- load_cytoframe_from_fcs(\"data/FlowRepository_FR-FCM-ZZ36_files/pbmc_luca.fcs\")\n\n\ntrans <- flowCore::transformList(\n  from = setdiff(\n    sampleNames(comp_cs),\n    \"Unstained\"\n  ),\n  tfun = flowCore::arcsinhTransform(b = 1/150)\n)\ncf_trans <- transform(\n  realize_view(cf),\n  trans   # transformation defined above\n) \n\n# plot pre-compensation\npre_compensation <- as.ggplot(\n  autoplot(\n    cf_trans,          # autoplot can be used to generate plots rapidly\n    x = \"PE-Cy5-5-A\", \n    y = \"PE-Cy5-A\", \n    bins = 256)+\n    labs(title = \"Uncompensated data\")\n)\n\n# compensate\ncf_comp <- compensate(realize_view(cf),spill)\ncf_comp <- transform(cf_comp,trans)\n\n# plot post-compensation\npost_compensation <- as.ggplot(\n  autoplot(\n    cf_comp,\n    x = \"PE-Cy5-5-A\", \n    y = \"PE-Cy5-A\", \n    bins = 256\n  )+\n  labs(title = \"Compensated data\")\n)\n\ngridExtra::grid.arrange(\n  pre_compensation, \n  post_compensation, \n  nrow = 1\n)\n```\n\n</details>\n","srcMarkdownNoYaml":"\n\n```{r,include=FALSE, echo=FALSE,eval=TRUE}\nlibrary(ggcyto)\nlibrary(flowCore)\nlibrary(flowWorkspace)\nlibrary(flowStats)\n```\n\n# Background\n\nIn this section, we aim to clarify the concept of Spillover, and the use of **spillover** matrix to correct for this. The last part of this section will deal with various transformations of the underlying expression data to aid in visualization and interpretation.\n\n## Spillover\n\nFlow cytometers (optics based: spectral or non-spectral) collect fluorescent signal from a cell as result of a laser excitation. Briefly, cell type **C** has been labelled with a marker **M** that is conjugated to a fluorophore (**F**). **F** is excited by a laser resulting in fluorescence. While the fluorescence has a emission maxima, the emission profile of **F** can span many nanometers. The cytometer has a dedicated detector (channel) **A** to detect peak emission of **F**. However, due to the spread of the emission of **F**, some signal from **F** is also \"spilled\" onto detector **B**, a detector for a different fluorophore.\n\nThe image below provides a concrete example.\n\n![Excitation/Emission spectra for FITC. Taken from Bio-Rad. A is the dedicated detector for FITC. B is a secondary detector where FITC signal spills over.](https://static.bio-rad-antibodies.com/2016/flow-cytometry/fig-9-spectral-profiles.png)\n\nThe **spillover** of signal onto secondary detector(s) is *additive* and can be easily recovered (more on this below).\n\nRaw Signal in $B = \\text{Signal from FITC (spillover)} + \\text{Signal from another (perhaps dedicated) fluorophore}.$\n\nFITC signal detected erroneously by secondary detectors can be estimated by a process of **fluorescence compensation** which requires a set of controls be present to calculate the spillover. These controls are called *Single Colour Controls* and are acquired prior to sample acquisition. The purpose of the single colour control is to estimate the amount of spillover of emission from fluorophore **F** onto non-primary detectors (detector **B** in the image above).\n\nWe note, but will not discuss further here that there are a class of more advanced fluorescence-based cytometers known as *spectral* flow cytometers. Spectral instruments require a different and more specialized procedure to perform compensation.\n\n## Importance of spillover correction\n\nLet's visualize the data to highlight the main issues related to spillover. We will make use of the `ggcyto` library from the `cytoverse` for this. We will dive into more details on the usage of `ggcyto` in a later section, as well as the \"transformation\" we are applying. For the moment, think of this transformation as a glorified log-transform to visualize the fluorescent signal that spans several orders of magnitude.\n\n```{r viz_uncompensated_data, echo=FALSE, eval=T, message=FALSE, fig.width=10}\n# read file\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")[,-32]\n\n# define transformation\ntrans <- transformList(\n  from = names(markernames(cf)),\n  tfun = (function(x)asinh(x/500))  # user definition\n) \n\n# transform\n# notice that we are creating a copy of the data\ncf_trans <- transform(\n  realize_view(cf),\n  trans\n)\n\n# plot\nuncompensated <- as.ggplot(\n  ggcyto(\n    cf_trans, # flowFrame, flowSet, cytoframe, cytoset, GatingSet, or GatingHierarchy can be used as data source\n    aes(x = \"CD3\", y = \"CD5\")  # automatic matching of markernames\n  ) + \n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Uncompensated data\")\n)\n\n# compensate\ncf_comp <- compensate(\n  realize_view(cf),\n  spillover(cf)[[\"$SPILLOVER\"]]\n)\n\n# transform\ncf_comp <- transform(cf_comp,trans)\n\n# plot\ncompensated <- as.ggplot(\n  ggcyto(\n    cf_comp, \n    aes(x = \"CD3\", y = \"CD5\")\n  ) +\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Compensated data\")+\n  axis_x_inverse_trans() # axis is transformed instead of data\n) \n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  uncompensated,\n  compensated,\n  nrow = 1, \n  top = \"1. Dicficulty resolving the correct populations\"\n)\n\n# plot uncompensated data\nuncompensated <- as.ggplot(\n  ggcyto(\n    cf_trans, \n    aes(x = \"SSC-A\", y = \"Live\")\n  )+\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Uncompensated data\")\n)\n\n# plot compensated data\ncompensated <- as.ggplot(\n  ggcyto(\n    cf_comp, \n    aes(x = \"SSC-A\", y = \"Live\")\n  )+\n  geom_hex(bins = 128)+\n  theme_bw()+\n  labs(title = \"Compensated data\")\n)\n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  uncompensated, \n  compensated, \n  nrow = 1, \n  top = \"2. Wrong conclusions\"\n)\n\n```\n\nIn example 1, the 2 fluorophores: PE-Cy5 and PE-Cy5.5 are spilling onto each other, making it impossible to resolve CD3+ (T cells) from non-T cells. However, after correcting for spillover (2nd plot), we see that two populations are visible in the G660-A CD3 PE-Cy5 channel.\n\nIn example 2, we see a population of events that are positive of marker: **Live Dead UV Blue**. It would be tempting to exclude these events as this marker is used to identify dead cells. However, in correctly compensated data, we see that this population actually is not present, but rather was an artifact of another dye spilling onto the U450 channel!\n\n## Spillover matrix: What does it look like? Where do you find it? How can you use it?\n\n### Embedded with the **.fcs** file\n\nIn many cases, the spillover matrix (which is used to correct the spillover) is attached to the **.fcs** files within `$SPILLOVER`,`SPILL`,or `SPILL` **keywords**. In `cytoverse`, we can check for the presence of by using the function `spillover(cf)`.\n\n#### Example: absent or incorrect\n\nFor this example, we are using data from the following dataset [FR-FCM-ZZ36](https://flowrepository.org/id/FR-FCM-ZZ36). The data was published in this [manuscript](10.1002/cyto.a.22278).\n\n```{r absent_spill, eval=TRUE, echo=TRUE, message=FALSE}\n# absent spill\ncf_absent <- load_cytoframe_from_fcs(\"data/FlowRepository_FR-FCM-ZZ36_files/pbmc_luca.fcs\")\n\n# check spillover results\nspillover(cf_absent)\n```\n\nNotice that there are 3 slots. Importantly, we notice a matrix within `$SPILL` slot which has 1's in the diagonal and 0's elsewhere. This is an identity matrix.\n\nObserving an identity matrix is likely an indication that the spillover has not been calculated. If this is the case, please see the section: [Calculating spillover from single colour controls (optional)].\n\n#### Example: valid spillover\n\nFor this example, we are using the dataset from [FR-FCM-Z5PC](https://flowrepository.org/public_experiment_representations/5932). The dataset was published in the following [paper](https://doi.org/10.1038/s41467-022-34638-2).\n\n```{r show_spill, echo=T, message=TRUE}\n# load cytoframe\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")\n\n# show spillover\nspillover(cf)\n```\n\nWe notice a few important details.\n\n-   It is not necessary that all 3 keywords have a matrix. Nor is it necessary that the matrix be present in a specific keyword.\n\n-   The spillover matrix is **square**. This is because the user will run 1 single colour control for each channel/marker they intend to acquire. In this example its 28 x 28\n\n-   The spillover matrix is non-identity with 1's in the diagonal!\n\nThe columns of the spillover matrix are the **detectors** while the rows are contribution from each **fluorophore**. Visualizing it as a heatmap is sometimes more helpful\n\n```{r explain_spillover, echo=FALSE, eval=TRUE, fig.height=10, fig.width=10}\n# extract spillover\ns.mat <- spillover(cf)[[3]]\nrownames(s.mat) <- markernames(cf)[-29]\n\npheatmap::pheatmap(\n  mat = s.mat,\n  cluster_rows = F,\n  cluster_cols = F,\n  color = colorRampPalette(\n    c(\"black\",\"orange\",\"cyan\",\"magenta\")\n  )(100),\n  display_numbers = T,\n  number_format = \"%.2f\",\n  legend = FALSE,\n  number_color = \"white\"\n)\n```\n\nLooking at the figure, column 2: B610-A (detector for fluorophore BB630) has high spillover from flurophore: PE-Dazzle594 and PE.\n\nIn fact, when we look at the emission spectrum of the 2 dyes (PE and BB630) we see that this issue is apparent:\n\n![Spectra from PE and BB630P2.](images/spectrumChart.png)The image was created at <https://www.bdbiosciences.com/en-ca/resources/bd-spectrum-viewer> using the BD spectrum viewer tool.\n\n### Using the spillover matrix\n\nNow that we have a valid spillover matrix, how do we use it to correct the data?\n\nFirst, we would like to highlight: **SPILLOVER CORRECTION IS DONE ON THE RAW (UNTRANSFORMED) DATA.**\n\nNow to perform spillover correction (**Compensation**). In the `cytoverse` this is done by a simple call to `compensate`.\n\n```{r compensate, echo=TRUE, eval=TRUE,message=FALSE}\n# single call to compensate \n# spillover(cf)[[3]] indicates where the matrix to use lives\ncf_comp <- compensate(\n  x = realize_view(cf),\n  spillover = spillover(cf)[[3]]\n) \n```\n\n\n## Transformation and visualization\n\nCytometry data tends to have a very high dynamic range. For example: the range of values in `PE-Cy5-5-A` channel in the FCS we have been working with is `-111 2621543`. The difference between cells that do not express a marker of interest and a cell that expresses variable level of marker could be order of magnitude. In such a scenario, transformation of the data can aid in **better visualization and representation of the biological phenomena**.\n\nThere are multiple approaches to transform the data in `cytoverse`. We will identify a few common ones as well as demonstrate how to create new transformations.\n\nFirst, let's visualize why transformation is necessary. We go back to working with data from [FR-FCM-Z5PC](https://flowrepository.org/public_experiment_representations/5932).\n\n```{r demo_transformations, echo=FALSE, eval=T, fig.width=10, fig.height=10}\n# read in fcs\ncf <- load_cytoframe_from_fcs(\"data/fcs-data/4000_BDC-CR1.fcs\")\n\n# apply compensation\ncf <- compensate(\n  cf, \n  spillover(cf)[[3]]\n)\n\n# plot linear compensated data\nlinear <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  ) +\n  labs(title = \"No transformation applied\")\n)\n\n# plot biexponential compensated data\nbiexp <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_flowjo_biexp()+\n  scale_y_flowjo_biexp()+\n  labs(title = \"Biexponential\"))\n\n# plot log compensated data\nlog_trans <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_continuous(trans = flowWorkspace::flowjo_log_trans())+\n  scale_y_continuous(trans = flowWorkspace::flowjo_log_trans())+\n  labs(title = \"Log\")\n)\n\n# plot asinh compensated data\nasinh_t <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_flowjo_fasinh()+\n  scale_y_flowCore_fasinh()+\n  labs(title = \"inverse hyperbolic sine\")\n)\n\n# plot logicle compensated data\nlogicle <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )+\n  scale_x_logicle()+\n  scale_y_logicle()+\n  labs(title = \"Logicle\")\n)\n\n# arrange plots for comparison\ngridExtra::grid.arrange(\n  linear,\n  biexp, \n  log_trans,\n  asinh_t, \n  logicle, \n  nrow = 2,\n  bottom = \"Generic transformations of compensated data\"\n)\n```\n\nAs we see, the variety of transformations aids in visualization and interpretation of the data.\n\nAlso note that the choice of transformation can and will affect the interpretation. As such, use a healthy dose of caution and follow established best practices. As well, when in doubt, talk to your collaborators.\n\n### Steps to transform data\n\nThe `cytoverse` libraries: `flowWorkspace` and `flowCore` have a multiple commonly used transformations (some are shown above) as well, one can also create a custom transformation if required.\n\nLet's first use a built in transformation.\n\n```{r how_to_transform_builtin, echo=T, eval=T, message=F}\n# transforming using cytoverse functions\n# define a transformation\nasinh_trans <- flowWorkspace::asinh_Gml2()\n\n# create a transformList that indicates which parameters to transform\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ),\n  tfun = asinh_trans\n)\n\n# transform \ncf_transformed <- flowCore::transform(\n  realize_view(cf),\n  my_trans_list\n)\n\n```\n\n```{r viz_transform, echo=FALSE, eval=TRUE, message=FALSE}\n# visualize linear compensated\ncf_comp <- as.ggplot(\n  autoplot(\n    cf,\n    x = \"CD14\", \n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# visualize transformed compensatd\ncf_comp_transformed <- as.ggplot(\n  autoplot(\n    cf_transformed,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# arrange plot for comparison\ngridExtra::grid.arrange(\n  cf_comp, \n  cf_comp_transformed, \n  nrow = 1\n)\n```\n\nAnother option is to use a user defined transformation.\n\n```{r user_defined_transformation,echo=TRUE,eval=TRUE}\n# define a transformation\nmy_trans <- function(x){\n  return(sqrt(abs(x)))\n}\n\n# create a transformList\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ), \n  tfun = my_trans\n)\n\n# transform\ncf_transformed <- transform(\n  realize_view(cf),\n  my_trans_list\n)\n```\n\n```{r viz_transform_user_defined, echo=FALSE, eval=FALSE, message=FALSE}\n# visualize custom transfromed compensated\ncf_comp_transformed <- as.ggplot(\n  autoplot(\n    cf_transformed,\n    x = \"CD14\",\n    y = \"HLA-DR\",\n    bins = 256\n  )\n)\n\n# arrange plots to compare with unstransformed data\ngridExtra::grid.arrange(\n  cf_comp,\n  cf_comp_transformed, \n  nrow = 1\n)\n```\n\nWe can also transform a set of FCS files (`cytoset`)\n\n```{r transform_cytoset, echo=TRUE, eval=TRUE}\n# read in a cytoset\ncs <- load_cytoset_from_fcs(path = \"data/fcs-data/\")\n\n# extract per file compensation matrix into a list\ncompensation_list <- lapply(cytoset_to_list(cs),\n                            function(x)spillover(x)[[3]])\n\n# compensate\ncs <- compensate(cs, compensation_list)\n\n# using asinh_trans defined previously\nmy_trans_list <- flowCore::transformList(\n  from = names(\n    markernames(cf)\n  ),\n  tfun = asinh_trans\n)\n\n# transform: this will transform the underlying data \ncs <- transform(cs,my_trans_list)\n```\n\n### Exercise\n\n1.  How can you tell if the data have been compensated? Use your preferred plotting method to generate a scatter plot for the following markers: `CADM1` and `CD141` from `cf` and `cf_comp`. You may need to transform the data for appropriate visualization.\n2.  Suppose the **.fcs** file does not have a spillover matrix or has an identity matrix. How confident can you be the data have been previously compensated (or not) ?\n\n# Conclusion\n\nIn this section we have described the concept of **spillover** and how to use the `spillover` matrix to correct for this phenomenon. As well, we described an approach to generate the `spillover` matrix when it is has not be pre-populated in the **.fcs** files. We also highlighted several built-in transformations in `cytoverse` as well as approaches to generate new user defined transformations. Data transformation is topic that can require several workshops in itself. As such, we encourage users/analyst to follow best and appropriate practices. A highly informative reading is the following: [An updated guide for the perplexed: cytometry in the high-dimensional era](https://pubmed.ncbi.nlm.nih.gov/34489590/).\n\n# Calculating spillover from single colour controls (optional)\n\nYou have noticed that there is no spillover matrix or an identity matrix is present when you call `spillover(cf)`. What can we do to calculate the spillover matrix in this scenario?\n\n<details>\n\nFirst, verify that you have additional set of **.fcs** files which either have **Compensation** or **control** in the file name. These control files are generally generated as part of experiment/instrument set up before acquisition begins. *If they are not available, please reach out to your collaborator or flow core manager.*\n\nGenerally, there ought to be the **same number** of single colour controls as the number of markers being assessed + 1 unstained to estimate the background auto-fluorescence.\n\nFor demonstration purposes, we will use single colour controls from the dataset: [FR-FCM-ZZ36](https://flowrepository.org/id/FR-FCM-ZZ36). The data was published in this [manuscript](10.1002/cyto.a.22278).\n\nHere, we will make use of a csv file which maps the control files to their respective channel as well as identifies the **unstained** file. *Note*: You may need to prepare such file in advance when working with your specific experiment.\n\n```{r generating_spillover_with_controls, echo=TRUE, eval =TRUE, message=FALSE, fig.width = 10, fig.height=10}\nlibrary(magrittr)\n\n# load csv file \ncsv_file <- read.csv(\"data/FlowRepository_FR-FCM-ZZ36_files/control_files.csv\")\n\n# take a peek at the file\ncsv_file\n\n# load the set of compensation files\ncomp_cs <- load_cytoset_from_fcs(\n  csv_file[[\"filename\"]],\n  path = \"data/FlowRepository_FR-FCM-ZZ36_files/\"\n)\nsampleNames(comp_cs) <- csv_file[[\"channel\"]]\n```\n\n```{r comp_viz, echo=FALSE, eval=TRUE, message=FALSE, fig.width=12, out.width=\"100%\"}\n# # quick visualization of what the control files contain\n# all_control_percp <- ggcyto::as.ggplot(\n#   ggcyto(\n#     comp_cs,\n#     aes(x = \"FSC-A\", y = \"PerCP-Cy5-5-A\")\n#   )+\n#   geom_hex(bins = 256)+\n#   theme_bw()+\n#   scale_y_flowCore_fasinh(b = 1/150)+\n#   labs(title = \"Detection of PerCP-Cy5-5 in all control samples \")\n# )\n# all_control_percp\nchans <- colnames(comp_cs)[-c(1,2,17)]\nchans <- chans[-match(sampleNames(comp_cs[1]), chans)]\nplots <- lapply(\n  chans,\n  function(x) {\n    ggcyto::as.ggplot(\n      ggcyto(\n        comp_cs[1],\n        aes(x = !!sampleNames(comp_cs[1]), y = !!x)\n      ) + \n      geom_hex(bins = 256) +\n      theme_bw() +\n      scale_y_flowCore_fasinh(b = 1/150)\n    )\n  }\n)\n\ndo.call(\n  gridExtra::grid.arrange,\n  c(\n    plots,\n    ncol = 4\n  )\n)\n\n```\n\nNotice that **Alexa Fluor 405** is spilling heavily into **Alexa Fluor 430-A** and **BV605-**, but not into any of the other detectors.\n\nNow, we calculate the spillover matrix using the set of controls. We will use `spillover` function from `flowStats` package within the `cytoverse`.\n\n```{r generating_spillover_with_controls_calculate, eval = TRUE, echo = TRUE, message = FALSE}\n# calculate spillover\n## using spillover from flowStats\nspill <- flowStats::spillover(\n  comp_cs,\n  unstained = \"Unstained\", # indicate how the unstained file is named in flowset\n  patt = \"-A\", # indicate which parameter should be considered \n  fsc = \"FSC-A\",\n  ssc = \"SSC-A\",\n  stain_match = \"regexpr\",\n  useNormFilt = TRUE\n)\n```\n\nNow, let's visualize the spill matrix that we calculated.\n\n```{r viz_calculated_spill, eval=T, echo=FALSE}\npheatmap::pheatmap(\n  mat = spill,\n  cluster_rows = F,\n  cluster_cols = F,\n  color = colorRampPalette(\n    c(\"black\",\"orange\",\"cyan\",\"magenta\")\n  )(100),\n  display_numbers = T, \n  legend = FALSE,\n  number_color = \"white\",\n  number_format = \"%.3f\"\n)\n```\n\n*Note: Close or related fluorophores will have some degree of overlap.*\n\nLastly, we check the effect of *compensating* these files.\n\n```{r show_comp_effect, echo=FALSE, eval=TRUE}\n# read in FCS\ncf <- load_cytoframe_from_fcs(\"data/FlowRepository_FR-FCM-ZZ36_files/pbmc_luca.fcs\")\n\n\ntrans <- flowCore::transformList(\n  from = setdiff(\n    sampleNames(comp_cs),\n    \"Unstained\"\n  ),\n  tfun = flowCore::arcsinhTransform(b = 1/150)\n)\ncf_trans <- transform(\n  realize_view(cf),\n  trans   # transformation defined above\n) \n\n# plot pre-compensation\npre_compensation <- as.ggplot(\n  autoplot(\n    cf_trans,          # autoplot can be used to generate plots rapidly\n    x = \"PE-Cy5-5-A\", \n    y = \"PE-Cy5-A\", \n    bins = 256)+\n    labs(title = \"Uncompensated data\")\n)\n\n# compensate\ncf_comp <- compensate(realize_view(cf),spill)\ncf_comp <- transform(cf_comp,trans)\n\n# plot post-compensation\npost_compensation <- as.ggplot(\n  autoplot(\n    cf_comp,\n    x = \"PE-Cy5-5-A\", \n    y = \"PE-Cy5-A\", \n    bins = 256\n  )+\n  labs(title = \"Compensated data\")\n)\n\ngridExtra::grid.arrange(\n  pre_compensation, \n  post_compensation, \n  nrow = 1\n)\n```\n\n</details>\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"embed-resources":true,"css":["../utils/css/custom.css"],"output-file":"2_Spillover_transformation.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":["cerulean","../utils/css/custom.scss"],"toc-expand":1,"toc-title":"Contents","smooth-scroll":true,"title":"Spillover, compensation, and Transformations","vignette":"%\\\\VignetteIndexEntry{Spillover, compensation, Transformations} %\\\\VignetteEngine{knitr::rmarkdown} %\\\\VignetteEncoding{UTF-8}\n"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}